#!/usr/bin/env python
# -*- coding:utf-8 -*-

from calibre.web.feeds.recipes import BasicNewsRecipe # 引入 Recipe 基础类

class Thinkphp3(BasicNewsRecipe): # 继承 BasicNewsRecipe 类的新类名

    # title = 'thinkphp3' # 电子书名
    # description = 'thinkphp3' # 电子书简介
    #cover_url = '' # 电子书封面
    #masthead_url = '' # 页头图片
    url_prefix = 'http://ergoemacs.org/emacs/'
    no_stylesheets = True # 去除 CSS 样式
    remove_javascript = True # 去除 JavaScript 脚本
    keep_only_tags = [{'name': 'main' }]
    # auto_cleanup = True # 自动清理 HTML 代码
    # delay = 5 # 抓取页面间隔秒数
    # oldest_article = 90
    # max_articles_per_feed = 190
    def parse_index(self):
        site = 'http://ergoemacs.org/emacs/elisp_perl_wrapper.html'

        soup = self.index_to_soup(site) # 解析列表页返回 BeautifulSoup 对象
        # links = soup.findAll("li",{"class":"list-group-item title"}) # 获取所有文章链接
        links = soup.find("div",{"class":"lpanel_h7h547"}) # 获取所有文章链接
        articles = [] # 定义空文章资源数组
        for link in links.findAll('a'): # 循环处理所有文章链接
            if  not link['href'].startswith("../emacs/emacs_best_keyboard"): 
                til = link.contents[0].strip()
                url = self.url_prefix + link['href']
                a = { 'title': til, 'url': url }
 
                articles.append(a)
        # a={'title':'hello','url':"http://ergoemacs.org/emacs/emacs_keybinding_overview.html"}
        # articles.append(a)
        ans = [('thinkphp3', articles)]

        return ans # 返回可供 Calibre 转换的数据结构

